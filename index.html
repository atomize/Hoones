<html>
<head>
    <title>Hoones | Javascript NES Emulator</title>
    <link href="./assets/css/foundation/foundation.css" rel="stylesheet">
    <link href="./assets/css/foundation/foundation-icons.css" rel="stylesheet">

    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script type="text/javascript" src="./assets/js/bigSlide/bigSlide.min.js"></script>
    <script type="text/javascript" src="./assets/js/foundation/foundation.js"></script>
    <script type="text/javascript" src="./assets/js/binFileReader/BinFileReader.js"></script>

    <link href="./assets/css/main.css" rel="stylesheet">
</head>
<body>


<div class="middle">
    <div class="menu">
        <div class="logo">HOONES</div>
        <div class="menu-item">
            <a style="float: left;" class="fi-plus large" title="Zoom in" onclick="doHigherRes()"></a>
            <div style="float: left; width: 8px; height: 1px"></div>
            <a style="float: left;" class="fi-minus large" title="Zoom out" onclick="doSmallerRes()"></a>
        </div>
        <div class="menu-item">
            <a class="fi-widget large" title="Settings"></a>
        </div>
        <div class="menu-item">
            <a class="fi-download large" data-open="romModal" title="Load Game" ></a>
        </div>
    </div>
    <canvas id="screen" height="100"></canvas>
    <div id="footer">
        Author: <a href="https://github.com/hkamran">Hooman Kamran</a>
    </div>
</div>


<div class="reveal" id="romModal" data-reveal style="padding: 0px; background: #323232; width: 400px; border-radius: 4px; box-shadow: 0px 0px 14px 4px rgba(0,0,0,0.75); border: 2px solid #1a1b18">
    <div style="min-height: 55px; padding: 10px; padding-left: 20px; width: auto; background: #2d2d2d; border-bottom: 2px solid #3d3d3d; ">
        <div class="logo">ROM</div>
    </div>
    <div style="padding: 10px; background: #313131">

        <div style="width: 80%; float: left; padding: 5px;">
            <div id="romOptionDiv">
                <select id="romOption" style="height: 43px; padding: 5px; margin: 0px; background: #444; border: 2px solid #4b4b4b; color: #9a969a; border-radius: 4px" onclick="romSelector.onchange()">
                    <option selected value="select" selected="selected" >Select</option>
                    <option value=""></option>
                    <option value="./roms/dkong.nes">Donkey Kong</option>
                    <option value="./roms/Contra (USA).nes">Contra</option>
                    <option value="./roms/SuperMarioBros.nes">Super Mario Bros</option>
                    <option value="./roms/Pac-Man (USA) (Namco).nes">Pacman</option>
                    <option value=""></option>
                    <option value="other">URL</option>

                </select>
            </div>
            <div id="romInputDiv" style="display:none;">
                <input id="romInput" type="text" pattern="url" placeholder="URL" style="height: 44px; margin: 0px; background: #444; border: 2px solid #484848; border-radius: 4px">
            </div>
        </div>
        <div style="width: 20%; float: left; padding: 5px;">
            <button class="button" value="Submit" onclick="romSelector.click()" type="submit" style="margin: 0px; border-radius: 4px; background: #444; border: 2px solid #484848; color: #9a969a;">Load</button>
        </div>
        <div style="clear: both"></div>
    </div>
    <div style="clear: both;"></div>

    <button onclick="romSelector.reset();" class="close-button" data-close aria-label="Close modal" type="button" style="background: #424242; padding: 2px; border-radius: 4px; ">
        <span aria-hidden="true">&times;</span>
    </button>
    <div style="clear: both"></div>
</div>

<script type="text/javascript">

    var romSelector = {
        showDropDown : function () {
            document.getElementById("romOptionDiv").style.display = 'initial';
            document.getElementById("romInputDiv").style.display = 'none';
            document.getElementById("romInput").style.value = "";
        },
        showInput : function() {
            document.getElementById("romOptionDiv").style.display = 'none';
            document.getElementById("romInputDiv").style.display = 'initial';
            document.getElementById("romInput").style.value = "";
        },
        onchange : function() {
            var e = document.getElementById("romOption");
            var option = e.options[e.selectedIndex].value;

            if (option.localeCompare("other") == 0) {
                this.showInput();
            } else {
                document.getElementById("romInput").style.value = option;
            }
        },
        reset : function() {
            this.showDropDown();
            $('#romOption option').each(function(){
                $(this).prop('selected', false);
            });
        },
        close : function() {
            this.reset();
        },
        click : function() {
            nes.load(document.getElementById("romInput").style.value);
            $('#romModal').foundation('close');
            this.reset();
        }

    }
</script>

<!--<div style=" position: fixed;-->
<!--right: 0; bottom: 0; height:  100%; z-index: -1;-->
<!--width: 100%;-->


<!--background-image: url('./images/mario_bg.png');-->
<!--background: linear-gradient( rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.25) ), url('./images/mario_bg.png');-->

<!--background-position: center top 0px ;-->
<!--background-repeat: no-repeat;-->
<!--background-size: cover;-->

<!--">-->

<nav id="menu" class="panel" role="navigation" style="border: 2px solid #434343; background: #323232">
    <ul id="Tabs">
        <li><a class="menu-link" href="#">Debugger</a></li>
    </ul>
    <div class="content">

        <div class="row">
            <div class="small-6 large-6 columns">
                <fieldset>
                    <legend>Console</legend>
                    <div style="color: #bebebe; display: inline-block">
                        <ul style="list-style: none;">
                            <li>
                                <div>CPU Cycles:</div>
                                <span id="cpucycles"></span></li>
                            <li>
                                <div>PPU Cycles:</div>
                                <span id="ppucycles"></span></li>
                            <li>
                                <div>Scanline:</div>
                                <span id="scanline"></span></li>
                            <li>
                                <div>Ticks:</div>
                                <span id="ticks"></span></li>
                        </ul>
                    </div>
                </fieldset>
            </div>
            <div class="small-6 large-6 columns">
                <fieldset>
                    <legend>Operation</legend>
                    <div style="color: #bebebe; display: inline-block">
                        <ul style="list-style: none;">
                            <li>
                                <div>Opcode:</div>
                                <span id="opcode"></span></li>
                            <li>
                                <div>Op:</div>
                                <span id="opname"></span></li>
                            <li>
                                <div>Mode:</div>
                                <span id="mode"></span></li>
                            <li>
                                <div>Address:</div>
                                <span id="opaddr"></span></li>
                        </ul>
                    </div>
                </fieldset>
            </div>
        </div>

        <div class="small-6 large-6 columns">
            <fieldset class="border">
                <legend>CPU</legend>
                <div style="color: #bebebe;">
                    <ul style="list-style: none;">
                        <li>
                            <div>PC:</div>
                            <span id="pc"></span></li>
                        <li>
                            <div>Accumulator:</div>
                            <span id="acc"></span></li>
                        <li>
                            <div>X:</div>
                            <span id="x"></span></li>
                        <li>
                            <div>Y:</div>
                            <span id="y"></span></li>
                        <li>
                            <div>SP:</div>
                            <span id="sp"></span></li>
                        <li>
                            <div>P:</div>
                            <span id="pflags"></span></li>
                        <ul style="list-style: none;margin-left: 20px; margin-top: 10px; margin-bottom: 10px">
                            <li>
                                <div>carry flag:</div>
                                <span id="carryFlag"></span></li>
                            <li>
                                <div>zero flag:</div>
                                <span id="zeroFlag"></span></li>
                            <li>
                                <div>interrupt flag:</div>
                                <span id="interruptFlag"></span></li>
                            <li>
                                <div>decimal</div>
                                <span id="decimalFlag"></span></li>
                            <li>
                                <div>break flag:</div>
                                <span id="breakFlag"></span></li>
                            <li>
                                <div>overflow flag:</div>
                                <span id="overflowFlag"></span></li>
                            <li>
                                <div>negative flag:</div>
                                <span id="negativeFlag"></span></li>
                        </ul>
                    </ul>
                </div>
            </fieldset>
            <fieldset class="border">
                <legend>Stack</legend>
                <div style="color: #bebebe; min-height: 18px;">
                    <span id="stack"> </span>
                </div>
            </fieldset>
        </div>


        <div class="small-6 large-6 columns">
            <fieldset>
                <legend>PPU</legend>
                <div style="color: #bebebe; display: inline-block">
                    <ul style="list-style: none;">
                        <li>
                            <div>VRAM Address:</div>
                            <span id="vram"></span>
                        </li>
                        <li>
                            <div>Temp Address:</div>
                            <span id="temp"></span>
                        </li>
                        <li>
                            <div>Control:</div>
                            <ul style="list-style: none;  margin-left: 20px; margin-top: 10px; margin-bottom: 10px">
                                <li>
                                    <div>nametable:</div>
                                    <span id="nametable"></span></li>
                                <li>
                                    <div>increment:</div>
                                    <span id="increment"></span></li>
                                <li>
                                    <div>sprite table:</div>
                                    <span id="spritetable"></span></li>
                                <li>
                                    <div>background table:</div>
                                    <span id="backgroundtable"></span></li>
                                <li>
                                    <div>sprite size:</div>
                                    <span id="spritesize"></span></li>
                                <li>
                                    <div>masterslave:</div>
                                    <span id="masterslave"></span></li>
                                <li>
                                    <div>nmi:</div>
                                    <span id="nmi"></span></li>
                            </ul>
                        </li>


                        <li>
                            <div>Mask:</div>
                            <ul style="list-style: none;  margin-left: 20px; margin-top: 10px; margin-bottom: 10px">
                                <li>
                                    <div>greyscale:</div>
                                    <span id="grayscale"></span></li>
                                <li>
                                    <div>showbgleft:</div>
                                    <span id="showbgleft"></span></li>
                                <li>
                                    <div>showspleft:</div>
                                    <span id="showspleft"></span></li>
                                <li>
                                    <div>showbg:</div>
                                    <span id="showbg"></span></li>
                                <li>
                                    <div>showsprites:</div>
                                    <span id="showsprites"></span></li>
                                <li>
                                    <div>increds:</div>
                                    <span id="increds"></span></li>
                                <li>
                                    <div>incgreens:</div>
                                    <span id="incgreens"></span></li>
                                <li>
                                    <div>incblues:</div>
                                    <span id="incblues"></span></li>
                            </ul>
                        </li>
                        <li>
                            <div>Status:</div>
                            <ul style="list-style: none;  margin-left: 20px; margin-top: 10px; margin-bottom: 10px">
                                <li>
                                    <div>spriteoverflow:</div>
                                    <span id="spriteoverflow"></span></li>
                                <li>
                                    <div>spritehit:</div>
                                    <span id="spritehit"></span></li>
                                <li>
                                    <div>vblank:</div>
                                    <span id="vblank"></span></li>
                                <li>
                                    <div>nmiOccurred:</div>
                                    <span id="nmiOccurred"></span></li>
                                <li>
                                    <div>writable:</div>
                                    <span id="writable"></span></li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </fieldset>
        </div>


    </div>
</nav>


<div style="background: #333; color: #fff" id="log" rows="500" cols="50">

</div>



<!-- NES IMPORT -->
<script type="text/javascript" src="./src/nes/cartridge.js"></script>
<script type="text/javascript" src="./src/nes/controller.js"></script>
<script type="text/javascript" src="./src/nes/cpu.js"></script>
<script type="text/javascript" src="./src/nes/ppu.js"></script>
<script type="text/javascript" src="./src/nes/nes.js"></script>

<script type="text/javascript" src="./src/keyboard.js"></script>
<script type="text/javascript" src="./src/debugger.js"></script>
<script type="text/javascript" src="./src/main.js"></script>


<script type="text/javascript">
    $(document).foundation();
</script>


<script>
    var log = function (val) {
        if (debug.output) {
            console.log(val);
        }
    };


    $(document).ready(function () {
        $('.menu-link').bigSlide(
                {
                    side: "right",
                    push: '.drawer-push',
                    menuWidth: '35.625em',
                    push: '.pushy'
                });
    });

    var doHigherRes = function () {
        if (ppu.screen.pixelSize == 2) {
            ppu.screen.spacer = 1;
        } else {
            ppu.screen.pixelSize++;
            ppu.screen.pixelSize = Math.min(2, ppu.screen.pixelSize);
        }

        ppu.screen.reset();
    };

    var doSmallerRes = function () {
        if (ppu.screen.pixelSize == 2 && ppu.screen.spacer != 0) {
            ppu.screen.spacer = 0;
            ppu.screen.reset();
            return;
        }

        ppu.screen.pixelSize--;
        ppu.screen.pixelSize = Math.max(1, ppu.screen.pixelSize);
        ppu.screen.reset();
    };
</script>
</body>
</html>