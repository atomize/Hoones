<html>
	<head>
		<title>test</title>
		<link href="./css/foundation.css" rel="stylesheet">
		<style>
			body {
				background-color: #181818;
				-webkit-font-smoothing: none;
			}

			li div, label {
				min-width: 120px; !important;
				font-weight: bold;
				color: #ffffff;
				display: inline-block;
				margin: 0px;
			}

			ul {
				margin: 0px;
				padding: 0px;
			}

			fieldset {
				color: #fff;
				padding: 10px;
				margin: 10px;

			}

			canvas {
				image-rendering: optimizeSpeed;             /* Older versions of FF          */
				image-rendering: -moz-crisp-edges;          /* FF 6.0+                       */
				image-rendering: -webkit-optimize-contrast; /* Safari                        */
				image-rendering: -o-crisp-edges;            /* OS X & Windows Opera (12.02+) */
				image-rendering: pixelated;                 /* Awesome future-browsers       */
				-ms-interpolation-mode: nearest-neighbor;   /* IE                            */
			}

			#Tabs {
				position: absolute;
				white-space: nowrap;
				top: 0;
				right: 100%;
				text-align: right;
				-webkit-transform-origin: 100% 100%;
				-webkit-transform: rotate(-90deg);
				transform-origin: 100% 100%;
				transform: rotate(-90deg);
				list-style: none;
				background: #4b4b4b;
				color: #fff;
				padding: 10px;


				border-color: #5b5b5b;
				border-style: solid;
				border-width: 2px 2px 0px 2px;

				-webkit-border-top-left-radius: 5px;
				-webkit-border-top-right-radius: 5px;
				-moz-border-radius-topleft: 5px;
				-moz-border-radius-topright: 5px;
				border-top-left-radius: 5px;
				border-top-right-radius: 5px;

				-webkit-box-shadow: -18px 0px 16px -13px rgba(0,0,0,0.85);
				-moz-box-shadow: -18px 0px 16px -13px rgba(0,0,0,0.85);
				box-shadow: -18px 0px 16px -13px rgba(0,0,0,0.85);


			}

			#Tabs .menu-link:active  {
				color: #fff; !important
			}


			#Tabs .menu-link:link {
				color: #fff;
			}

			#Tabs .menu-link:visited {
				color: #fff;
			}


			.panel {
				position: fixed;
				right: -30.625em;
				width: 30.625em;

			}

			#menu .content span, div {
				color: #fff;
				font-size: 12px;
			}

			#menu {
				-webkit-box-shadow: -14px 0px 28px -13px rgba(0,0,0,0.75);
				-moz-box-shadow: -14px 0px 28px -13px rgba(0,0,0,0.75);
				box-shadow: -14px 0px 28px -13px rgba(0,0,0,0.75);
			}
		</style>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
		<script src="js/bigSlide/bigSlide.min.js"></script>
	</head>
	<body>


	<div class="row " style="height: 100%; position: relative;">
		<div class="small-6 large-6 columns pushy" style="top: 50%; transform: translateY(-50%);">
			<fieldset>
				<legend>Screen</legend>
				<canvas id="screen" height="100" style="display: block;"></canvas>
			</fieldset>
		</div>
	</div>

	<nav id="menu" class="panel" role="navigation" style="border: 2px solid #434343; background: #323232" >
		<ul id="Tabs">
			<li><a class="menu-link" href="#">Debugger</a></li>
		</ul>
		<div class="content">

			<div class="row">
				<div class="small-6 large-6 columns">
					<fieldset>
						<legend>Console</legend>
						<div style="color: #bebebe; display: inline-block">
							<ul style="list-style: none;">
								<li><div>CPU Cycles: </div><span id="cpucycles"></span></li>
								<li><div>PPU Cycles: </div><span id="ppucycles"></span></li>
								<li><div>Scanline: </div><span id="scanline"></span></li>
								<li><div>Ticks: </div><span id="ticks"></span></li>
							</ul>
						</div>
					</fieldset>
				</div>
				<div class="small-6 large-6 columns">
					<fieldset>
						<legend>Operation</legend>
						<div style="color: #bebebe; display: inline-block">
							<ul style="list-style: none;">
								<li><div>Opcode: </div><span id="opcode"></span></li>
								<li><div>Op: </div><span id="opname"></span></li>
								<li><div>Mode: </div><span id="mode"></span></li>
								<li><div>Address: </div><span id="opaddr"></span></li>
							</ul>
						</div>
					</fieldset>
				</div>
			</div>

			<div class="small-6 large-6 columns">
				<fieldset class="border">
					<legend>CPU</legend>
					<div style="color: #bebebe;">
						<ul style="list-style: none;">
							<li><div>PC: </div><span id="pc"></span></li>
							<li><div>Accumulator: </div><span id="acc"></span></li>
							<li><div>X: </div><span id="x"></span></li>
							<li><div>Y: </div><span id="y"></span></li>
							<li><div>SP: </div><span id="sp"></span></li>
							<li><div>P: </div><span id="pflags"></span></li>
							<ul style="list-style: none;margin-left: 20px; margin-top: 10px; margin-bottom: 10px">
								<li><div>carry flag:</div><span id="carryFlag"></span></li>
								<li><div>zero flag:</div><span id="zeroFlag"></span></li>
								<li><div>interrupt flag:</div><span id="interruptFlag"></span></li>
								<li><div>decimal </div><span id="decimalFlag"></span></li>
								<li><div>break flag:</div><span id="breakFlag"></span></li>
								<li><div>overflow flag:</div><span id="overflowFlag"></span></li>
								<li><div>negative flag:</div><span id="negativeFlag"></span></li>
							</ul>
						</ul>
					</div>
				</fieldset>
				<fieldset class="border">
					<legend>Stack</legend>
					<div style="color: #bebebe; min-height: 18px;">
						<span id="stack"> </span>
					</div>
				</fieldset>
			</div>


			<div class="small-6 large-6 columns" >
				<fieldset>
					<legend>PPU</legend>
					<div style="color: #bebebe; display: inline-block">
						<ul style="list-style: none;">
							<li>
								<div>VRAM Address: </div><span id="vram"></span>
							</li>
							<li>
								<div>Temp Address: </div><span id="temp"></span>
							</li>
							<li>
								<div>Control:</div>
								<ul style="list-style: none;  margin-left: 20px; margin-top: 10px; margin-bottom: 10px">
									<li><div>nametable:</div><span id="nametable"></span></li>
									<li><div>increment:</div><span id="increment"></span></li>
									<li><div>sprite table:</div><span id="spritetable"></span></li>
									<li><div>background table:</div><span id="backgroundtable"></span></li>
									<li><div>sprite size:</div><span id="spritesize"></span></li>
									<li><div>masterslave:</div><span id="masterslave"></span></li>
									<li><div>nmi:</div><span id="nmi"></span></li>
								</ul>
							</li>



							<li><div>Mask:</div>
								<ul style="list-style: none;  margin-left: 20px; margin-top: 10px; margin-bottom: 10px">
									<li><div>greyscale:</div><span id="grayscale"></span></li>
									<li><div>showbgleft:</div><span id="showbgleft"></span></li>
									<li><div>showspleft:</div><span id="showspleft"></span></li>
									<li><div>showbg:</div><span id="showbg"></span></li>
									<li><div>showsprites:</div><span id="showsprites"></span></li>
									<li><div>increds:</div><span id="increds"></span></li>
									<li><div>incgreens:</div><span id="incgreens"></span></li>
									<li><div>incblues:</div><span id="incblues"></span></li>
								</ul>
							</li>
							<li>
								<div>Status:</div>
								<ul style="list-style: none;  margin-left: 20px; margin-top: 10px; margin-bottom: 10px">
									<li><div>spriteoverflow:</div><span id="spriteoverflow"></span></li>
									<li><div>spritehit:</div><span id="spritehit"></span></li>
									<li><div>vblank:</div><span id="vblank"></span></li>
									<li><div>nmiOccurred:</div><span id="nmiOccurred"></span></li>
									<li><div>writable:</div><span id="writable"></span></li>
								</ul>
							</li>
						</ul>
					</div>
				</fieldset>
			</div>


		</div>
	</nav>


	<div style="background: #333; color: #fff" id="log" rows="500" cols="50">

	</div>
	<script type="text/javascript" src="js/hoones/lib/BinFileReader.js"></script>
	<script type="text/javascript" src="js/hoones/cartridge.js"></script>
	<script type="text/javascript" src="js/hoones/cpu.js"></script>
	<script type="text/javascript" src="js/hoones/ppu.js"></script>
	<script type="text/javascript" src="js/hoones/nes.js"></script>
	<script type="text/javascript">

		nes.load("./roms/dkong.nes");
		nes.reset();
		
	</script>

	<script type="text/javascript">

		function regStatus() {


			document.getElementById("carryFlag").innerHTML = cpu.registers.p.c == 1;
			document.getElementById("zeroFlag").innerHTML = cpu.registers.p.z == 1;
			document.getElementById("interruptFlag").innerHTML = cpu.registers.p.i == 1;
			document.getElementById("decimalFlag").innerHTML = cpu.registers.p.d == 1;
			document.getElementById("breakFlag").innerHTML = cpu.registers.p.b == 1;
			document.getElementById("overflowFlag").innerHTML = cpu.registers.p.v == 1;
			document.getElementById("negativeFlag").innerHTML = cpu.registers.p.n == 1;

			document.getElementById("pc").innerHTML = "0x" + cpu.registers.pc.get().toString(16).toUpperCase();
			document.getElementById("acc").innerHTML = "0x" + cpu.registers.a.get().toString(16).toUpperCase();
			document.getElementById("x").innerHTML = "0x" + cpu.registers.x.get().toString(16).toUpperCase();
			document.getElementById("y").innerHTML = "0x" + cpu.registers.y.get().toString(16).toUpperCase();
			document.getElementById("sp").innerHTML = "0x" + cpu.registers.sp.get().toString(16).toUpperCase();
			document.getElementById("pflags").innerHTML = "0x" + cpu.registers.p.get().toString(16).toUpperCase();

			document.getElementById("nametable").innerHTML = "0x" + ppu.registers.cntrl.nametable;
			document.getElementById("increment").innerHTML = "0x" + ppu.registers.cntrl.increment;
			document.getElementById("spritetable").innerHTML = "0x" + ppu.registers.cntrl.spritetable;
			document.getElementById("backgroundtable").innerHTML = "0x" + ppu.registers.cntrl.backgroundtable;
			document.getElementById("spritesize").innerHTML = "0x" + ppu.registers.cntrl.spritesize;
			document.getElementById("masterslave").innerHTML = "0x" + ppu.registers.cntrl.masterslave;
			document.getElementById("nmi").innerHTML = "0x" + ppu.registers.cntrl.nmi;

			document.getElementById("grayscale").innerHTML = "0x" + ppu.registers.mask.greyscale;
			document.getElementById("showbgleft").innerHTML = "0x" + ppu.registers.mask.showbgleft;
			document.getElementById("showspleft").innerHTML = "0x" + ppu.registers.mask.showspleft;
			document.getElementById("showbg").innerHTML = "0x" + ppu.registers.mask.showbg;
			document.getElementById("showsprites").innerHTML = "0x" + ppu.registers.mask.showsprites;
			document.getElementById("increds").innerHTML = "0x" + ppu.registers.mask.increds;
			document.getElementById("incgreens").innerHTML = "0x" + ppu.registers.mask.incgreens;
			document.getElementById("incblues").innerHTML = "0x" + ppu.registers.mask.incblues;

			document.getElementById("spriteoverflow").innerHTML = "0x" + ppu.registers.status.spriteoverflow;
			document.getElementById("spritehit").innerHTML = "0x" + ppu.registers.status.spritehit;
			document.getElementById("vblank").innerHTML = "0x" + ppu.registers.status.vblank;
			document.getElementById("nmiOccurred").innerHTML = "0x" + ppu.nmi.occurred ? 1:0 ;
			document.getElementById("writable").innerHTML = "0x" + ppu.vars.w;

			//document.getElementById("val").innerHTML = "0x" + ppu.registers.scroll.data.toString(16).toUpperCase();

			document.getElementById("vram").innerHTML = "0x" + ppu.vars.v.toString(16).toUpperCase();
			document.getElementById("temp").innerHTML = "0x" + ppu.vars.t.toString(16).toUpperCase();
			//document.getElementById("xpos").innerHTML = "0x" + ppu.background.xpos.toString(16).toUpperCase();
			//document.getElementById("ypos").innerHTML = "0x" + ppu.background.ypos.toString(16).toUpperCase();
			//document.getElementById("nameaddr").innerHTML = "0x" + ppu.background.nameTableAddr.toString(16).toUpperCase();
			//document.getElementById("tileaddr").innerHTML = "0x" + ppu.background.fetchTileAddr().toString(16).toUpperCase();
			//document.getElementById("namebyte").innerHTML = "0x" + ppu.background.nameTableByte.toString(16).toUpperCase();
			//document.getElementById("tilebyte").innerHTML = "0x" + ppu.mmu.readByte(ppu.background.fetchTileAddr()).toString(16).toUpperCase();
			//document.getElementById("lowbyte").innerHTML = "0x" + ppu.background.lowTileByte.toString(16).toUpperCase();
			//document.getElementById("highbyte").innerHTML = "0x" + ppu.background.highTileByte.toString(16).toUpperCase();
				 
			 
			var st = "";
			var comma = " ,";
			for (var i = cpu.mmu.stack.data.length - 1; i >= cpu.registers.sp.get() + 1; i--) {

				if (i == 0) {
					comma = "";
				}
				var result = cpu.mmu.stack.data[i];
				if (typeof result == 'undefined') {
					st += "0xERR" + comma;
				} else {
					st += "0x" + cpu.mmu.stack.data[i].toString(16).toUpperCase() + comma;
				}
			}

			document.getElementById("stack").innerHTML = st;

			var op = cpu.op;
			if (op) {
				document.getElementById("opcode").innerHTML = "0x" + cpu.op.opcode.toString(16).toUpperCase();
				document.getElementById("opname").innerHTML = cpu.op.op.name;
				document.getElementById("mode").innerHTML = cpu.op.op.mode.name.toUpperCase();
				document.getElementById("opaddr").innerHTML = "0x" + cpu.op.address.toString(16).toUpperCase();
			} else {
				document.getElementById("opcode").innerHTML = "NULL";
				document.getElementById("opname").innerHTML = "NULL";
				document.getElementById("mode").innerHTML = "NULL";
				document.getElementById("opaddr").innerHTML = "NULL";
			}

			document.getElementById("cpucycles").innerHTML = cpu.cycles;
			document.getElementById("ppucycles").innerHTML = ppu.cycle;
			document.getElementById("scanline").innerHTML = ppu.scanline;
			document.getElementById("ticks").innerHTML = cpu.ticks;

		};

		function opCodeUpdate(val) {
			if (val && val.opcode) {
				document.getElementById("opcode").innerHTML = val.opcode.name;
				document.getElementById("opaddr").innerHTML = val.address.toString(16).toUpperCase();
			}
		};

		function tick() {
			nes.tick();
			regStatus();
		};

		function tickFor(val) {
			nes.tickFor(val);
			regStatus();
		};

		var counter = 1;

		function output(val) {
			document.getElementById("log").innerHTML = document.getElementById("log").innerHTML + "</br>" + counter + " " + val;
			counter++;
		};

		$(window).keypress(function (e) {
			if (e.keyCode === 0 || e.keyCode === 32) {
				e.preventDefault();
				tick();
			}
		});

		
	(function() {
		var lastTime = 0;
		var vendors = ['ms', 'moz', 'webkit', 'o'];
		for(var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {
			window.requestAnimationFrame = window[vendors[x]+'RequestAnimationFrame'];
			window.cancelAnimationFrame = window[vendors[x]+'CancelAnimationFrame'] 
									   || window[vendors[x]+'CancelRequestAnimationFrame'];
		}
	 
		if (!window.requestAnimationFrame)
			window.requestAnimationFrame = function(callback, element) {
				var currTime = new Date().getTime();
				var timeToCall = Math.max(0, 16 - (currTime - lastTime));
				var id = window.setTimeout(function() { callback(currTime + timeToCall); }, 
				  timeToCall);
				lastTime = currTime + timeToCall;
				return id;
			};
	 
		if (!window.cancelAnimationFrame)
			window.cancelAnimationFrame = function(id) {
				clearTimeout(id);
			};
	}());	

	var fps = 60;
	var startEmulation = false;
	var interval = 1000 / fps;
		ppu.screen.reset();
	function draw() {
		setTimeout(function() {
			window.requestAnimationFrame(draw);

			nes.tickFor(29829);
			ppu.renderer.tick();


		}, interval);
	}

	
		




	</script>	
	

	<script type="text/javascript">

		//nametable.init();
		//nametable.draw([[],[],[],[]]);
	</script>
	<script>
		$(document).ready(function() {
			$('.menu-link').bigSlide(
					{side: "right",
						push: '.drawer-push',
						menuWidth: '35.625em',
						push: '.pushy'
					});
		});
	</script>


	</body>
</html>